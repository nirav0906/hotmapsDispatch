# -*- coding: utf-8 -*-
"""
Created on Tue Sep 26 11:52:51 2017

@author: root
"""

import os
import sys
import pandas as pd
import numpy as np
import json
import pickle

path = os.path.dirname(os.path.dirname(os.path.dirname(os.path.
                                                       abspath(__file__))))
if path not in sys.path:
    sys.path.append(path)


path_parameter2 = path + r"\FEAT\F16\input.xlsx"
path2data = os.path.split(os.path.abspath(__file__))[0]
path_parameter = path2data + r"\DH_technology_cost.xlsx"
init_data=("Wien",2016)

def return_dict(name_dat,init_data=init_data):
    val = pickle.load(open(path2data+r"\\"+name_dat+".dat", "rb"))[init_data]
    return dict(zip(range(1,len(val)+1),val.tolist()))

def load_data():
    
    data1 = pd.read_excel(path_parameter,skiprows=[1])
    tec = list(data1.tec.values)
    data1 = data1.set_index("tec").to_dict()
    data2 = pd.read_excel(path_parameter,"prices and emmision factors",skiprows=[1]).fillna(0)
    data2 = data2.set_index("energy_carrier").to_dict()
    data3 = pd.read_excel(path_parameter,"financal and other parameteres",skiprows=[1]).fillna(0)
    data3 = data3.to_dict("records")[0]
    data = {**data1, **data2,**data3}
    
    try:
        data4 = pd.read_excel(path_parameter2,"Data",skiprows=range(3,5)).fillna(0)
    except:
        data4 = pd.read_excel(path_parameter2,"Data").fillna(0)
    data5 = pd.read_excel(path_parameter2,"Parameter for Powerplants",skiprows=range(21,26)).fillna(0)
    data6 = pd.read_excel(path_parameter2,"prices and emmision factors").fillna(0)
    
   
    
    data1 = pd.read_excel(path_parameter)[0:1]
    input_list_mapper = dict(zip(data1.values[0].tolist(),list(data1)))
    data2 = pd.read_excel(path_parameter,"prices and emmision factors")[0:1]
    input_price_list_mapper = dict(zip(data2.values[0].tolist(),list(data2)))
    data3 = pd.read_excel(path_parameter,"financal and other parameteres")[0:1]
    parameter_list_mapper = dict(zip(data3.values[0].tolist(),list(data3)))
    
    dic5 = data5.set_index("name").to_dict()
    for key in list(dic5):
        data[input_list_mapper[key]]=dic5[key]
        
    dic6=data6.set_index("energy carrier").to_dict()
    for key in list(dic6):
        data[input_price_list_mapper[key]] = dic6[key]
        
    for key in list(data4):
        data[parameter_list_mapper[key]]= data4[key].values[0]
        
    val = pickle.load(open(path2data+r"\load_profiles.dat", "rb"))    
    demand = val[init_data]
    sum_demand = sum(demand)
    demand_neu = demand / sum_demand * float(data4["Total Demand[ MWh]"].values[0])
    data["demand_th"] = dict(zip(range(1,len(demand_neu)+1),demand_neu.tolist()))
    

    data["radiation"] = return_dict("radiation_profiles")
    data["temp"] = return_dict("temperature_profile")
    data["energy_carrier_prices"]["electricity"] = return_dict("prices")
    data["tec"] = tec
    
    
    inv_flag = 0
    

    return data, inv_flag 


if __name__ == "__main__":
    print('Loading Data...')
    val,flag = load_data()
    print('Loading done')
    
    

